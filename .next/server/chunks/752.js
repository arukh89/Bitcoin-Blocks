"use strict";exports.id=752,exports.ids=[752],exports.modules={4085:(e,t,r)=>{r.d(t,{hY:()=>i,lI:()=>s,o3:()=>o});class a extends Error{constructor(e,t={}){let r=(()=>{if(t.cause instanceof a){if(t.cause.details)return t.cause.details;if(t.cause.shortMessage)return t.cause.shortMessage}return t.cause&&"details"in t.cause&&"string"==typeof t.cause.details?t.cause.details:t.cause?.message?t.cause.message:t.details})();super([e||"An error occurred.",...t.metaMessages?["",...t.metaMessages]:[],...r?["",r?`Details: ${r}`:void 0]:[]].filter(e=>"string"==typeof e).join("\n"),t.cause?{cause:t.cause}:void 0),this.name="BaseError",this.cause=t.cause,this.details=r,this.shortMessage=e}}class o extends a{constructor({status:e}){super(`Request failed with status ${e}`),this.name="RequestFailedError"}}class s extends a{constructor(e){super(e),this.name="InvalidToken"}}class i extends a{constructor(e){super(e),this.name="InvalidToken"}}},5752:(e,t,r)=>{let a;r.d(t,{U:()=>eI});var o=r(4085);async function s({origin:e}){let t=await fetch(`${e}/nonce`,{method:"POST"});if(!t.ok)throw new o.o3({status:t.status});return await t.json()}var i=r(7067),n=r(4708),c=r(8474);class l extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class u extends l{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.claim=r,this.reason=a,this.payload=t}}class d extends l{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.claim=r,this.reason=a,this.payload=t}}class h extends l{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class f extends l{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class y extends l{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class p extends l{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class m extends l{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class w extends l{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t)}}class g extends l{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}class b extends l{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(e="request timed out",t){super(e,t)}}class S extends l{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}let E=new TextEncoder,k=new TextDecoder;function _(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let a of e)t.set(a,r),r+=a.length;return t}let v=async(e,t,r)=>{let a;switch(e.protocol){case"https:":a=n.get;break;case"http:":a=i.get;break;default:throw TypeError("Unsupported URL protocol.")}let{agent:o,headers:s}=r,u=a(e.href,{agent:o,timeout:t,headers:s}),[d]=await Promise.race([(0,c.once)(u,"response"),(0,c.once)(u,"timeout")]);if(!d)throw u.destroy(),new b;if(200!==d.statusCode)throw new l("Expected 200 OK from the JSON Web Key Set HTTP response");let h=[];for await(let e of d)h.push(e);try{return JSON.parse(k.decode(_(...h)))}catch{throw new l("Failed to parse the JSON Web Key Set HTTP response as JSON")}};var T=r(4573);let A=e=>new Uint8Array(T.Buffer.from(function(e){let t=e;return t instanceof Uint8Array&&(t=k.decode(t)),t}(e),"base64url"));var R=r(7598);let K=e=>e.d?(0,R.createPrivateKey)({format:"jwk",key:e}):(0,R.createPublicKey)({format:"jwk",key:e});function P(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}async function O(e,t){if(!P(e))throw TypeError("JWK must be an object");switch(t||=e.alg,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return A(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new f('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return K({...e,alg:t});default:throw new f('Unsupported "kty" (Key Type) Parameter value')}}function I(e){return P(e)}function J(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}class W{_jwks;_cached=new WeakMap;constructor(e){if(!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(I)}(e))throw new m("JSON Web Key Set malformed");this._jwks=J(e)}async getKey(e,t){let{alg:r,kid:a}={...e,...t?.header},o=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new f('Unsupported "alg" value for a JSON Web Key Set')}}(r),s=this._jwks.keys.filter(e=>{let t=o===e.kty;if(t&&"string"==typeof a&&(t=a===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":t="Ed25519"===e.crv;break;case"EdDSA":t="Ed25519"===e.crv||"Ed448"===e.crv}return t}),{0:i,length:n}=s;if(0===n)throw new w;if(1!==n){let e=new g,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(let e of s)try{yield await j(t,e,r)}catch{}},e}return j(this._cached,i,r)}}async function j(e,t,r){let a=e.get(t)||e.set(t,{}).get(t);if(void 0===a[r]){let e=await O({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new m("JSON Web Key Set members must be public keys");a[r]=e}return a[r]}function D(e){let t=new W(e),r=async(e,r)=>t.getKey(e,r);return Object.defineProperties(r,{jwks:{value:()=>J(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(a="jose/v5.10.0");let $=Symbol();class N{_url;_timeoutDuration;_cooldownDuration;_cacheMaxAge;_jwksTimestamp;_pendingFetch;_options;_local;_cache;constructor(e,t){if(!(e instanceof URL))throw TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:t?.agent,headers:t?.headers},this._timeoutDuration="number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3,this._cooldownDuration="number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5,t?.[$]!==void 0&&(this._cache=t?.[$],function(e,t){return!("object"!=typeof e||null===e||!("uat"in e)||"number"!=typeof e.uat||Date.now()-e.uat>=t)&&"jwks"in e&&!!P(e.jwks)&&!!Array.isArray(e.jwks.keys)&&!!Array.prototype.every.call(e.jwks.keys,P)}(t?.[$],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=D(this._cache.jwks)))}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._local&&this.fresh()||await this.reload();try{return await this._local(e,t)}catch(r){if(r instanceof w&&!1===this.coolingDown())return await this.reload(),this._local(e,t);throw r}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0);let e=new Headers(this._options.headers);a&&!e.has("User-Agent")&&(e.set("User-Agent",a),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||=v(this._url,this._timeoutDuration,this._options).then(e=>{this._local=D(e),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=e),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e}),await this._pendingFetch}}var x=r(7975);function H(e){switch(e){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"Ed25519":case"EdDSA":return;default:throw new f(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}let C=R.webcrypto,M=e=>x.types.isCryptoKey(e),L=e=>x.types.isKeyObject(e);function U(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let F=(e,...t)=>U("Key must be ",e,...t);function G(e,t,...r){return U(`Key for the ${e} algorithm must be `,t,...r)}let V=e=>L(e)||M(e),q=["KeyObject"];function B(e){return P(e)&&"string"==typeof e.kty}(globalThis.CryptoKey||C?.CryptoKey)&&q.push("CryptoKey"),new WeakMap;let Y=e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new f("Unsupported key curve for this operation")}},z=(e,t)=>{let r;if(M(e))r=R.KeyObject.from(e);else if(L(e))r=e;else if(B(e))return e.crv;else throw TypeError(F(e,...q));if("secret"===r.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(r.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${r.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${r.asymmetricKeyType.slice(1)}`;case"ec":{let e=r.asymmetricKeyDetails.namedCurve;if(t)return e;return Y(e)}default:throw TypeError("Invalid asymmetric key type for this operation")}},X=(e,t)=>{let r;try{r=e instanceof R.KeyObject?e.asymmetricKeyDetails?.modulusLength:Buffer.from(e.n,"base64url").byteLength<<3}catch{}if("number"!=typeof r||r<2048)throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)},Q=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function Z(e,t){let r,a,o,s;if(t instanceof R.KeyObject)r=t.asymmetricKeyType,a=t.asymmetricKeyDetails;else switch(o=!0,t.kty){case"RSA":r="rsa";break;case"EC":r="ec";break;case"OKP":if("Ed25519"===t.crv){r="ed25519";break}if("Ed448"===t.crv){r="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(e){case"Ed25519":if("ed25519"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519");break;case"EdDSA":if(!["ed25519","ed448"].includes(r))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");X(t,e);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===r){let{hashAlgorithm:t,mgf1HashAlgorithm:r,saltLength:o}=a,s=parseInt(e.slice(-3),10);if(void 0!==t&&(t!==`sha${s}`||r!==t))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}`);if(void 0!==o&&o>s>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}`)}else if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");X(t,e),s={padding:R.constants.RSA_PKCS1_PSS_PADDING,saltLength:R.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let a=z(t),o=Q.get(e);if(a!==o)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${o}, got ${a}`);s={dsaEncoding:"ieee-p1363"};break}default:throw new f(`alg ${e} is not supported either by JOSE or your javascript runtime`)}return o?{format:"jwk",key:t,...s}:s?{...s,key:t}:t}function ee(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function et(e,t){return e.name===t}function er(e){return parseInt(e.name.slice(4),10)}function ea(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(F(t,...q));return(0,R.createSecretKey)(t)}if(t instanceof R.KeyObject)return t;if(M(t))return!function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!et(e.algorithm,"HMAC"))throw ee("HMAC");let r=parseInt(t.slice(2),10);if(er(e.algorithm.hash)!==r)throw ee(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!et(e.algorithm,"RSASSA-PKCS1-v1_5"))throw ee("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(er(e.algorithm.hash)!==r)throw ee(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!et(e.algorithm,"RSA-PSS"))throw ee("RSA-PSS");let r=parseInt(t.slice(2),10);if(er(e.algorithm.hash)!==r)throw ee(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw ee("Ed25519 or Ed448");break;case"Ed25519":if(!et(e.algorithm,"Ed25519"))throw ee("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!et(e.algorithm,"ECDSA"))throw ee("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw ee(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}var a=e,o=r;if(o.length&&!o.some(e=>a.usages.includes(e))){let e="CryptoKey does not support this operation, its usages must include ";if(o.length>2){let t=o.pop();e+=`one of ${o.join(", ")}, or ${t}.`}else 2===o.length?e+=`one of ${o[0]} or ${o[1]}.`:e+=`${o[0]}.`;throw TypeError(e)}}(t,e,r),R.KeyObject.from(t);if(B(t))return e.startsWith("HS")?(0,R.createSecretKey)(Buffer.from(t.k,"base64url")):t;throw TypeError(F(t,...q,"Uint8Array","JSON Web Key"))}let eo=(0,x.promisify)(R.sign),es=async(e,t,r)=>{let a=ea(e,t,"sign");if(e.startsWith("HS")){let t=R.createHmac(function(e){switch(e){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new f(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e),a);return t.update(r),t.digest()}return eo(H(e),r,Z(e,a))},ei=(0,x.promisify)(R.verify),en=async(e,t,r,a)=>{let o=ea(e,t,"verify");if(e.startsWith("HS")){let t=await es(e,o,a);try{return R.timingSafeEqual(r,t)}catch{return!1}}let s=H(e),i=Z(e,o);try{return await ei(s,a,i,r)}catch{return!1}},ec=(...e)=>{let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0},el=e=>e?.[Symbol.toStringTag],eu=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(r)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},ed=(e,t,r,a)=>{if(!(t instanceof Uint8Array)){if(a&&B(t)){if(function(e){return B(e)&&"oct"===e.kty&&"string"==typeof e.k}(t)&&eu(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!V(t))throw TypeError(G(e,t,...q,"Uint8Array",a?"JSON Web Key":null));if("secret"!==t.type)throw TypeError(`${el(t)} instances for symmetric algorithms must be of type "secret"`)}},eh=(e,t,r,a)=>{if(a&&B(t))switch(r){case"sign":if(function(e){return"oct"!==e.kty&&"string"==typeof e.d}(t)&&eu(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(function(e){return"oct"!==e.kty&&void 0===e.d}(t)&&eu(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!V(t))throw TypeError(G(e,t,...q,a?"JSON Web Key":null));if("secret"===t.type)throw TypeError(`${el(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${el(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${el(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${el(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${el(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function ef(e,t,r,a){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?ed(t,r,a,e):eh(t,r,a,e)}ef.bind(void 0,!1);let ey=ef.bind(void 0,!0),ep=function(e,t,r,a,o){let s;if(void 0!==o.crit&&a?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!a||void 0===a.crit)return new Set;if(!Array.isArray(a.crit)||0===a.crit.length||a.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let i of(s=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,a.crit)){if(!s.has(i))throw new f(`Extension Header Parameter "${i}" is not recognized`);if(void 0===o[i])throw new e(`Extension Header Parameter "${i}" is missing`);if(s.get(i)&&void 0===a[i])throw new e(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(a.crit)},em=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function ew(e,t,r){let a,o;if(!P(e))throw new y("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new y('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new y("JWS Protected Header incorrect type");if(void 0===e.payload)throw new y("JWS Payload missing");if("string"!=typeof e.signature)throw new y("JWS Signature missing or incorrect type");if(void 0!==e.header&&!P(e.header))throw new y("JWS Unprotected Header incorrect type");let s={};if(e.protected)try{let t=A(e.protected);s=JSON.parse(k.decode(t))}catch{throw new y("JWS Protected Header is invalid")}if(!ec(s,e.header))throw new y("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let i={...s,...e.header},n=ep(y,new Map([["b64",!0]]),r?.crit,s,i),c=!0;if(n.has("b64")&&"boolean"!=typeof(c=s.b64))throw new y('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:l}=i;if("string"!=typeof l||!l)throw new y('JWS "alg" (Algorithm) Header Parameter missing or invalid');let u=r&&em("algorithms",r.algorithms);if(u&&!u.has(l))throw new h('"alg" (Algorithm) Header Parameter value not allowed');if(c){if("string"!=typeof e.payload)throw new y("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new y("JWS Payload must be a string or an Uint8Array instance");let d=!1;"function"==typeof t?(t=await t(s,e),d=!0,ey(l,t,"verify"),B(t)&&(t=await O(t,l))):ey(l,t,"verify");let f=_(E.encode(e.protected??""),E.encode("."),"string"==typeof e.payload?E.encode(e.payload):e.payload);try{a=A(e.signature)}catch{throw new y("Failed to base64url decode the signature")}if(!await en(l,t,a,f))throw new S;if(c)try{o=A(e.payload)}catch{throw new y("Failed to base64url decode the payload")}else o="string"==typeof e.payload?E.encode(e.payload):e.payload;let p={payload:o};return(void 0!==e.protected&&(p.protectedHeader=s),void 0!==e.header&&(p.unprotectedHeader=e.header),d)?{...p,key:t}:p}async function eg(e,t,r){if(e instanceof Uint8Array&&(e=k.decode(e)),"string"!=typeof e)throw new y("Compact JWS must be a string or Uint8Array");let{0:a,1:o,2:s,length:i}=e.split(".");if(3!==i)throw new y("Invalid Compact JWS");let n=await ew({payload:o,protected:a,signature:s},t,r),c={payload:n.payload,protectedHeader:n.protectedHeader};return"function"==typeof t?{...c,key:n.key}:c}let eb=e=>Math.floor(e.getTime()/1e3),eS=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,eE=e=>{let t,r=eS.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let a=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(a);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*a);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*a);break;case"day":case"days":case"d":t=Math.round(86400*a);break;case"week":case"weeks":case"w":t=Math.round(604800*a);break;default:t=Math.round(0x1e187e0*a)}return"-"===r[1]||"ago"===r[4]?-t:t},ek=e=>e.toLowerCase().replace(/^application\//,""),e_=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),ev=(e,t,r={})=>{let a,o;try{a=JSON.parse(k.decode(t))}catch{}if(!P(a))throw new p("JWT Claims Set must be a top-level JSON object");let{typ:s}=r;if(s&&("string"!=typeof e.typ||ek(e.typ)!==ek(s)))throw new u('unexpected "typ" JWT header value',a,"typ","check_failed");let{requiredClaims:i=[],issuer:n,subject:c,audience:l,maxTokenAge:h}=r,f=[...i];for(let e of(void 0!==h&&f.push("iat"),void 0!==l&&f.push("aud"),void 0!==c&&f.push("sub"),void 0!==n&&f.push("iss"),new Set(f.reverse())))if(!(e in a))throw new u(`missing required "${e}" claim`,a,e,"missing");if(n&&!(Array.isArray(n)?n:[n]).includes(a.iss))throw new u('unexpected "iss" claim value',a,"iss","check_failed");if(c&&a.sub!==c)throw new u('unexpected "sub" claim value',a,"sub","check_failed");if(l&&!e_(a.aud,"string"==typeof l?[l]:l))throw new u('unexpected "aud" claim value',a,"aud","check_failed");switch(typeof r.clockTolerance){case"string":o=eE(r.clockTolerance);break;case"number":o=r.clockTolerance;break;case"undefined":o=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:y}=r,m=eb(y||new Date);if((void 0!==a.iat||h)&&"number"!=typeof a.iat)throw new u('"iat" claim must be a number',a,"iat","invalid");if(void 0!==a.nbf){if("number"!=typeof a.nbf)throw new u('"nbf" claim must be a number',a,"nbf","invalid");if(a.nbf>m+o)throw new u('"nbf" claim timestamp check failed',a,"nbf","check_failed")}if(void 0!==a.exp){if("number"!=typeof a.exp)throw new u('"exp" claim must be a number',a,"exp","invalid");if(a.exp<=m-o)throw new d('"exp" claim timestamp check failed',a,"exp","check_failed")}if(h){let e=m-a.iat;if(e-o>("number"==typeof h?h:eE(h)))throw new d('"iat" claim timestamp check failed (too far in the past)',a,"iat","check_failed");if(e<0-o)throw new u('"iat" claim timestamp check failed (it should be in the past)',a,"iat","check_failed")}return a};async function eT(e,t,r){let a=await eg(e,t,r);if(a.protectedHeader.crit?.includes("b64")&&!1===a.protectedHeader.b64)throw new p("JWTs MUST NOT use unencoded payload");let o={payload:ev(a.protectedHeader,a.payload,r),protectedHeader:a.protectedHeader};return"function"==typeof t?{...o,key:a.key}:o}let eA={},eR=e=>(eA[e]||(eA[e]=function(e,t){let r=new N(e,void 0),a=async(e,t)=>r.getKey(e,t);return Object.defineProperties(a,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>r._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),a}(new URL(e))),eA[e]);async function eK({origin:e},t){let r=eR(`${e}/.well-known/jwks.json`);try{let{payload:a}=await eT(t.token,r,{issuer:e,audience:t.domain});return a}catch(e){if(e instanceof p||e instanceof d||e instanceof u)throw new o.hY(e.message);throw e}}async function eP(e,t){return eK(e,t)}async function eO({origin:e},t){let r=await fetch(`${e}/verify-siwf`,{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(t)});if(!r.ok)throw new o.o3({status:r.status});let a=await r.json();if(!1===a.valid)throw new o.lI(a.message??"unknown");return{token:a.token}}function eI(e={}){let t=function(e={}){return{origin:e.origin??"https://auth.farcaster.xyz"}}(e);return{generateNonce:()=>s(t),verifyJwt:e=>eP(t,e),verifySiwf:e=>eO(t,e)}}}};
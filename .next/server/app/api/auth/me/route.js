(()=>{var e={};e.id=673,e.ids=[673],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3939:e=>{"use strict";e.exports=require("@supabase/supabase-js")},4573:e=>{"use strict";e.exports=require("node:buffer")},4708:e=>{"use strict";e.exports=require("node:https")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6007:(e,t,r)=>{"use strict";r.d(t,{ow:()=>i}),r(7885);class s{constructor(){this.errors=[],this.maxErrors=100,this.shouldLogToConsole=!1,this.shouldLogToService="true"===process.env.NEXT_PUBLIC_ERROR_LOGGING}static getInstance(){return s.instance||(s.instance=new s),s.instance}generateErrorId(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getContext(){return{timestamp:Date.now()}}handleGlobalError(e){this.logError(e.message||"Unknown error","system","high",{...this.getContext(),component:"global",additionalData:{filename:e.filename,lineno:e.lineno,colno:e.colno}},e.error)}handleUnhandledRejection(e){this.logError("Unhandled promise rejection","system","high",{...this.getContext(),component:"promise",additionalData:{reason:e.reason}},e.reason)}logError(e,t,r,s={},o){let i=this.generateErrorId(),n={id:i,message:e,category:t,severity:r,context:{timestamp:Date.now(),...this.getContext(),...s},stack:o instanceof Error?o.stack:void 0,originalError:o};this.errors.push(n),this.errors.length>this.maxErrors&&(this.errors=this.errors.slice(-this.maxErrors)),this.shouldLogToConsole&&this.logErrorToConsole(n),this.shouldLogToService&&this.sendToErrorService(n).catch(e=>{console.error("Failed to send error to logging service:",e)});try{let e=JSON.parse(localStorage.getItem("error_logs")||"[]");e.push(n),e.length>50&&e.splice(0,e.length-50),localStorage.setItem("error_logs",JSON.stringify(e))}catch(e){console.warn("Failed to store error in localStorage:",e)}return i}logErrorToConsole(e){let{severity:t,message:r,category:s,context:o,stack:i}=e,n=this.getSeverityEmoji(t);console.group(`${n} [${t.toUpperCase()}] ${s}: ${r}`),console.log("Context:",o),i&&console.log("Stack trace:",i),console.groupEnd()}getSeverityEmoji(e){switch(e){case"low":return"\uD83D\uDFE1";case"medium":return"\uD83D\uDFE0";case"high":return"\uD83D\uDD34";case"critical":return"\uD83D\uDC80";default:return"⚪"}}async sendToErrorService(e){try{let t=await fetch("/api/errors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(`HTTP ${t.status}: ${t.statusText}`)}catch(e){console.error("Failed to send error to service:",e)}}getErrors(e){return e?this.errors.slice(-e):[...this.errors]}clearErrors(){this.errors=[]}getErrorStats(){let e={low:0,medium:0,high:0,critical:0};return this.errors.forEach(t=>{e[t.severity]++}),e}}let o=s.getInstance(),i=(e,t,r)=>o.logError(e,"system","medium",t,r)},7002:()=>{},7067:e=>{"use strict";e.exports=require("node:http")},7598:e=>{"use strict";e.exports=require("node:crypto")},7677:(e,t,r)=>{"use strict";r.d(t,{E2:()=>i,ND:()=>o});var s=r(3939);console.log("\uD83D\uDD0D DEBUG - Supabase Client Initialization:",{runtime:"server",nodeEnv:"production",nextRuntime:"nodejs",supabaseUrl:"configured",hasAnonKey:!0,timestamp:new Date().toISOString()});let o=(0,s.createClient)("https://masgfwpxfytraiwkvbmg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1hc2dmd3B4Znl0cmFpd2t2Ym1nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2OTQ5NTYsImV4cCI6MjA3NjI3MDk1Nn0.QAVE2pVMR869KycgzXe2MaQyJTyQb-yZM5zfIbtsMDM",{db:{schema:"public"},realtime:{params:{eventsPerSecond:10,reconnectDelay:2e3,maxReconnectAttempts:10,heartbeatIntervalMs:3e4,wsCloseTimeout:5e3}},auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!1,debug:!1,flowType:"pkce"},global:{headers:{"x-application-name":"bitcoin-blocks-miniapp","x-application-version":"1.0.0","x-client-type":"web","x-content-type-options":"nosniff","x-frame-options":"DENY","x-xss-protection":"1; mode=block"}}}),i=(0,s.createClient)("https://masgfwpxfytraiwkvbmg.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1,debug:!1},db:{schema:"public"},global:{headers:{"x-application-name":"bitcoin-blocks-miniapp-admin","x-application-version":"1.0.0","x-client-type":"admin","x-privilege-level":"service-role"}}});async function n(){try{let{data:e,error:t}=await o.from("rounds").select("id").limit(1).single();if(t&&"PGRST116"!==t.code)return console.warn("⚠️ Supabase connection check failed:",t),!1;return!0}catch(e){return console.error("❌ Supabase connection check error:",e),!1}}class a{static getInstance(){return a.instance||(a.instance=new a),a.instance}startMonitoring(){this.checkInterval||(this.checkConnection(),this.checkInterval=setInterval(()=>{this.checkConnection()},this.CHECK_INTERVAL))}stopMonitoring(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}async checkConnection(){let e=await n();e!==this.isConnected&&(this.isConnected=e,this.notifyListeners(e),e?console.log("✅ Supabase connection restored"):console.warn("⚠️ Supabase connection lost"))}notifyListeners(e){this.listeners.forEach(t=>{try{t(e)}catch(e){console.error("❌ Error in connection listener:",e)}})}addListener(e){this.listeners.push(e)}removeListener(e){let t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}getConnectionStatus(){return this.isConnected}constructor(){this.isConnected=!1,this.checkInterval=null,this.CHECK_INTERVAL=3e4,this.listeners=[]}}a.getInstance()},7975:e=>{"use strict";e.exports=require("node:util")},8474:e=>{"use strict";e.exports=require("node:events")},8850:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9658:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>g,serverHooks:()=>w,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>b});var s={};r.r(s),r.d(s,{GET:()=>m});var o=r(9682),i=r(1739),n=r(6442),a=r(9667),c=r(5752),l=r(4085),u=r(7677),p=r(6007);let d=(0,c.U)(),h=new Map;async function m(e){let t=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown";if(!function(e,t=10,r=6e4){let s=Date.now(),o=h.get(e);return!o||s>o.resetTime?(h.set(e,{count:1,resetTime:s+r}),!0):!(o.count>=t)&&(o.count++,!0)}(t))return a.NextResponse.json({error:"Rate limit exceeded"},{status:429});try{let r,s,o=e.headers.get("Authorization");if(!o||!o.startsWith("Bearer "))return a.NextResponse.json({error:"Missing or invalid authorization header"},{status:401});let i=o.split(" ")[1];if(!i)return a.NextResponse.json({error:"Missing token"},{status:401});let n=0;for(;n<3;)try{r=await d.verifyJwt({token:i,domain:"localhost:3000"});break}catch(e){if(++n>=3)throw e;await new Promise(e=>setTimeout(e,1e3*n))}let c=0;for(;c<3;)try{let e=await fetch(`https://api.farcaster.xyz/v2/user?fid=${r.sub}`,{headers:{"api-key":process.env.FARCASTER_API_KEY||"wc_secret_13ae99f53a4f0874277616da7b10bddf6d01a2ea5eac4d8c6380e877_9b6b2830","User-Agent":"Bitcoin-Blocks-Mini-App/1.0"},signal:AbortSignal.timeout(1e4)});if(e.ok){let t=await e.json(),o=t.result?.user||t.user;s={fid:o.fid||r.sub,username:o.username||`user-${r.sub}`,displayName:o.display_name||o.displayName||`User ${r.sub}`,pfpUrl:o.pfp_url||o.pfpUrl||"",bio:o.profile?.bio?.text||o.bio||""}}else s={fid:r.sub,username:`user-${r.sub}`,displayName:`User ${r.sub}`,pfpUrl:"",bio:""};break}catch(e){if(++c>=3){s={fid:r.sub,username:`user-${r.sub}`,displayName:`User ${r.sub}`,pfpUrl:"",bio:""};break}await new Promise(e=>setTimeout(e,1e3*c))}let{data:l}=await u.E2.from("admin_fids").select("fid, permissions").eq("fid",s.fid.toString()).single(),h=!!l,m=l?.permissions||[],g={fid:s.fid.toString(),session_data:{address:`fid-${s.fid}`,username:s.username,displayName:s.displayName,pfpUrl:s.pfpUrl,bio:s.bio,isAdmin:h,permissions:m,createdAt:Date.now(),lastActive:Date.now()},created_at:Date.now(),expires_at:Date.now()+864e5,last_ip:t};try{await u.E2.from("user_sessions").upsert(g,{onConflict:"fid"})}catch(e){await (0,p.ow)("Failed to store user session",{action:"session_storage",additionalData:{fid:s.fid,ip:t}},e)}try{await u.E2.from("audit_logs").insert({admin_fid:s.fid.toString(),action:"user_login",details:{ip:t,userAgent:e.headers.get("user-agent")||"unknown",timestamp:new Date().toISOString()},created_at:Date.now()})}catch(e){console.error("Failed to log user login:",e)}return a.NextResponse.json({...s,address:`fid-${s.fid}`,isAdmin:h,permissions:m})}catch(r){if(await (0,p.ow)("Authentication error",{action:"user_auth",additionalData:{ip:t,userAgent:e.headers.get("user-agent")||"unknown"}},r),r instanceof l.hY)return a.NextResponse.json({error:"Invalid token"},{status:401});return a.NextResponse.json({error:"Internal server error"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/me/route",pathname:"/api/auth/me",filename:"route",bundlePath:"app/api/auth/me/route"},resolvedPagePath:"c:\\Users\\UserBQ\\Downloads\\mini app\\blocks\\src\\app\\api\\auth\\me\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:b,serverHooks:w}=g;function x(){return(0,n.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:b})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[859,176,752],()=>r(9658));module.exports=s})();
(()=>{var e={};e.id=591,e.ids=[591],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5485:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>g,serverHooks:()=>f,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{GET:()=>p,POST:()=>d});var o=t(9682),n=t(1739),a=t(6442),i=t(9667),c=t(6007);let u=process.env.FARCASTER_API_KEY||"wc_secret_13ae99f53a4f0874277616da7b10bddf6d01a2ea5eac4d8c6380e877_9b6b2830",l=new Map;async function d(e){let r;try{let{message:t,address:s,embeds:o}=r=await e.json();if(!t||"string"!=typeof t)return i.NextResponse.json({error:"Missing or invalid message parameter"},{status:400});if(t.length>320)return i.NextResponse.json({error:"Message too long (max 320 characters)"},{status:400});if(!s||!["fid-250704","fid-1107084"].includes(s))return await (0,c.ow)("Unauthorized announcement attempt",{action:"unauthorized_announcement",additionalData:{address:s,message:t.substring(0,50)+"..."}},Error("Unauthorized user attempted to post announcement")),i.NextResponse.json({error:"Unauthorized: Only admin users can post announcements"},{status:403});if(!function(e,r=5,t=36e5){let s=Date.now(),o=l.get(e);return!o||s>o.resetTime?(l.set(e,{count:1,resetTime:s+t}),!0):!(o.count>=r)&&(o.count++,!0)}(s))return i.NextResponse.json({error:"Rate limit exceeded: Maximum 5 announcements per hour"},{status:429});let n={text:t,embeds:o||[]},a=0,d=null;for(;a<3;)try{let e=await fetch("https://api.warpcast.com/v2/casts",{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json","User-Agent":"Bitcoin-Blocks-Mini-App/1.0"},body:JSON.stringify(n),signal:AbortSignal.timeout(15e3)});if(!e.ok){let r=await e.text();throw Error(`Farcaster API returned ${e.status}: ${r}`)}let r=await e.json();return await (0,c.ow)("Announcement posted successfully",{action:"announcement_posted",additionalData:{address:s,messageLength:t.length,hasEmbeds:!!(o&&o.length>0)}},Error("Success log")),i.NextResponse.json({success:!0,message:"Announcement posted successfully",cast:r.result?.cast||r.cast||r})}catch(e){d=e,++a<3&&await new Promise(e=>setTimeout(e,2e3*a))}return await (0,c.ow)("Failed to post announcement after retries",{action:"announcement_failed",additionalData:{address:s,attempts:a,message:t.substring(0,50)+"..."}},d||Error("Unknown error")),i.NextResponse.json({error:"Failed to post to Farcaster after multiple attempts",details:d?.message||"Unknown error",success:!1},{status:503})}catch(e){return await (0,c.ow)("Farcaster announce error",{action:"announce_error",additionalData:{address:r?.address,messageLength:r?.message?.length||0}},e),i.NextResponse.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error",success:!1},{status:500})}}async function p(){return i.NextResponse.json({enabled:!0,apiKeyConfigured:!!u,adminAddresses:["fid-250704","fid-1107084"]})}let g=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/farcaster-announce/route",pathname:"/api/farcaster-announce",filename:"route",bundlePath:"app/api/farcaster-announce/route"},resolvedPagePath:"c:\\Users\\UserBQ\\Downloads\\mini app\\blocks\\src\\app\\api\\farcaster-announce\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:m,serverHooks:f}=g;function w(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:m})}},6007:(e,r,t)=>{"use strict";t.d(r,{ow:()=>n}),t(7885);class s{constructor(){this.errors=[],this.maxErrors=100,this.shouldLogToConsole=!1,this.shouldLogToService="true"===process.env.NEXT_PUBLIC_ERROR_LOGGING}static getInstance(){return s.instance||(s.instance=new s),s.instance}generateErrorId(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getContext(){return{timestamp:Date.now()}}handleGlobalError(e){this.logError(e.message||"Unknown error","system","high",{...this.getContext(),component:"global",additionalData:{filename:e.filename,lineno:e.lineno,colno:e.colno}},e.error)}handleUnhandledRejection(e){this.logError("Unhandled promise rejection","system","high",{...this.getContext(),component:"promise",additionalData:{reason:e.reason}},e.reason)}logError(e,r,t,s={},o){let n=this.generateErrorId(),a={id:n,message:e,category:r,severity:t,context:{timestamp:Date.now(),...this.getContext(),...s},stack:o instanceof Error?o.stack:void 0,originalError:o};this.errors.push(a),this.errors.length>this.maxErrors&&(this.errors=this.errors.slice(-this.maxErrors)),this.shouldLogToConsole&&this.logErrorToConsole(a),this.shouldLogToService&&this.sendToErrorService(a).catch(e=>{console.error("Failed to send error to logging service:",e)});try{let e=JSON.parse(localStorage.getItem("error_logs")||"[]");e.push(a),e.length>50&&e.splice(0,e.length-50),localStorage.setItem("error_logs",JSON.stringify(e))}catch(e){console.warn("Failed to store error in localStorage:",e)}return n}logErrorToConsole(e){let{severity:r,message:t,category:s,context:o,stack:n}=e,a=this.getSeverityEmoji(r);console.group(`${a} [${r.toUpperCase()}] ${s}: ${t}`),console.log("Context:",o),n&&console.log("Stack trace:",n),console.groupEnd()}getSeverityEmoji(e){switch(e){case"low":return"\uD83D\uDFE1";case"medium":return"\uD83D\uDFE0";case"high":return"\uD83D\uDD34";case"critical":return"\uD83D\uDC80";default:return"âšª"}}async sendToErrorService(e){try{let r=await fetch("/api/errors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw Error(`HTTP ${r.status}: ${r.statusText}`)}catch(e){console.error("Failed to send error to service:",e)}}getErrors(e){return e?this.errors.slice(-e):[...this.errors]}clearErrors(){this.errors=[]}getErrorStats(){let e={low:0,medium:0,high:0,critical:0};return this.errors.forEach(r=>{e[r.severity]++}),e}}let o=s.getInstance(),n=(e,r,t)=>o.logError(e,"system","medium",r,t)},7002:()=>{},8850:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[859,176],()=>t(5485));module.exports=s})();